#!/bin/bash

update () {
  rm -rf "$HOME/.$1"
  ln -s "$PWD/$1" "$HOME/.$1"
}

update xinitrc
update bashrc
update zshrc
update bash_profile
update inputrc
update gvimrc
update vimrc
update tmux.conf
update gitignore
update gitconfig
update R
update Rprofile
update sbcl_completions

rm -rf "$HOME/scripts"
ln -s "$PWD/scripts" "$HOME/scripts"

rm -rf "$HOME/.config/roxterm.sourceforge.net"
ln -s "$PWD/roxterm" "$HOME/.config/roxterm.sourceforge.net"

sudo rm -f '/usr/share/zsh/functions/Prompts/prompt_asb_setup'
sudo ln -s $(readlink -m $PWD/prompt_asb_setup) \
  /usr/share/zsh/functions/Prompts/prompt_asb_setup

if [[ -f /usr/bin/packer ]]; then
  if [[ -f /usr/bin/powerline ]]; then
    echo 'Powerline found.'
  else
    echo 'No powerline but also no packer. Install manually.'
  fi
else
  packer -S python-powerline-git
fi

# Assuming the submodule is populated
fzf/uninstall
fzf/install
rm "$HOME"/.fzf.{ba,z}sh
git checkout .

if [[ "$1" == "--vundle" ]]; then
  rm -rf ~/.vim
  mkdir -p ~/.vim/bundle
  git clone 'https://github.com/VundleVim/Vundle.vim' ~/.vim/bundle/Vundle.vim
  vim +PluginInstall +qall
  ln -s "$(readlink -m "$PWD"/mysnippets)" ~/.vim
  rm -r \
    ~/.vim/bundle/LaTeX-Suite-aka-Vim-LaTeX/ftplugin/latex-suite/templates/*
  ln -s "$PWD"/latex-templates/article.tex \
    ~/.vim/bundle/LaTeX-Suite-aka-Vim-LaTeX/ftplugin/latex-suite/templates/article.tex
  ln -s "$PWD"/latex-templates/beamer.tex \
    ~/.vim/bundle/LaTeX-Suite-aka-Vim-LaTeX/ftplugin/latex-suite/templates/beamer.tex
fi

[[ ! -d ~/.fonts ]] && mkdir -p ~/.fonts
[[ ! -f ~/.fonts/Monaco_Linux.ttf ]] && cp "$PWD"/Monaco_Linux.ttf ~/.fonts
[[ ! -d ~/.icons/default/ ]] && mkdir -p ~/.icons/default && \
  cp "$PWD"/index.theme ~/.icons/default/index.theme

exit 0
