#!/bin/bash

update () {
  rm -rf "$HOME/.$1"
  ln -s "$PWD/$1" "$HOME/.$1"
}

mk-dir-if-not-found () {
  [[ ! -d "$1" ]] &&
    mkdir -p "$1"
}

update xinitrc
update bashrc
update zshrc
update bash_profile
update inputrc
update gvimrc
update vimrc
update tmux.conf
update gitignore
update gitconfig
update R
update Rprofile
update sbcl_completions
update emacs
update dircolors
update devilspie

rm -rf "$HOME/scripts"
ln -s "$PWD/scripts" "$HOME/scripts"

rm -rf "$HOME/.config/roxterm.sourceforge.net"
ln -s "$PWD/roxterm" "$HOME/.config/roxterm.sourceforge.net"

sudo rm -f '/usr/share/zsh/functions/Prompts/prompt_asb_setup'
sudo ln -s $(readlink -m $PWD/prompt_asb_setup) \
  /usr/share/zsh/functions/Prompts/prompt_asb_setup
mk-dir-if-not-found "$HOME"/.cache/zsh

if [[ -f /usr/bin/packer ]]; then
  if [[ -f /usr/bin/powerline ]]; then
    echo 'Powerline found.'
  else
    packer -S python-powerline-git
  fi
else
  echo 'No powerline but also no packer. Install manually.'
fi

# Assuming the submodule is populated
fzf/uninstall
fzf/install
rm "$HOME"/.fzf.{ba,z}sh
git checkout .

mk-dir-if-not-found "$HOME"/.emacs-auto-backups

mk-dir-if-not-found "$HOME"/.fonts
cp "$PWD"/Monaco_Linux.ttf "$HOME"/.fonts

mk-dir-if-not-found "$HOME"/.icons/default
cp "$PWD"/index.theme "$HOME"/.icons/default/index.theme

if [[ "$1" == "--vundle" ]]; then
  rm -rf "$HOME"/.vim
  mkdir -p "$HOME"/.vim/bundle
  git clone 'https://github.com/VundleVim/Vundle.vim' \
      "$HOME"/.vim/bundle/Vundle.vim
  vim +PluginInstall +qall
  ln -s "$(readlink -m "$PWD"/mysnippets)" "$HOME"/.vim
  rm -r "$HOME"/.vim/bundle/LaTeX-Suite-aka-Vim-LaTeX/ftplugin/latex-suite/templates/*
  ln -s "$PWD"/latex-templates/article.tex "$HOME"/.vim/bundle/LaTeX-Suite-aka-Vim-LaTeX/ftplugin/latex-suite/templates/article.tex
  ln -s "$PWD"/latex-templates/beamer.tex "$HOME"/.vim/bundle/LaTeX-Suite-aka-Vim-LaTeX/ftplugin/latex-suite/templates/beamer.tex
fi

if [[ "$1" == "--nukemacs" || "$2" == "--nukemacs" ]]; then
  rm -rf "$HOME"/.emacs.d
fi

R CMD INSTALL setwidth*.tar.gz colorout*.tar.gz VimCom

"$HOME"/scripts/load-cinnamon-settings

exit 0
